<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Cloud Messaging Test</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js';
        import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-messaging.js';

        const firebaseConfig = {
            apiKey: process.env.FIREBASE_CLIENT_APIKEY,
            authDomain: process.env.FIREBASE_CLIENT_AUTH_DOMAIN,
            projectId: process.env.FIREBASE_CLIENT_PROJECT_ID,
            storageBucket: process.env.FIREBASE_CLIENT_STORAGE_BUCKET,
            messagingSenderId: process.env.FIREBASE_CLIENT_MESSAGING_SENDER_ID,
            appId: process.env.FIREBASE_CLIENT_APP_ID,
            measurementId: process.env.FIREBASE_CLIENT_MEASUREMENT_ID
        };

        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./firebase-messaging-sw.js')
            .then((registration) => {
                console.log('Service Worker registered with scope:', registration.scope);
            })
            .catch((err) => {
                console.error('Service Worker registration failed:', err);
            });
        }

        document.getElementById('subscribe').onclick = async () => {
            try {
                const permission = await Notification.requestPermission();

                if (permission === "granted") {
                    const token = await getToken(messaging, { vapidKey: 'BKXiDCmTB-vVOsDHI1iDXULiKo_WH7nmHuGVEKDf9oI93OyCQEppebp1LKr__W-NjnUAVgS6mdbLcdlQet71Z_s' });
                    document.getElementById('token').innerText = `Registration Token: ${token}`;
                    
                    console.log("FCM Registration Token:", token);
                } else {
                    console.error("Permission not granted for notifications");
                }
            } catch (error) {
                console.error("Error getting token:", error);
            }
        };

        onMessage(messaging, (payload) => {
            console.log('Message received in the foreground: ', payload);
        });
    </script>
</head>
<body>
    <h1>Firebase Cloud Messaging</h1>
    <button id="subscribe">Subscribe to Notifications</button>
    <p id="token"></p>
</body>
</html>